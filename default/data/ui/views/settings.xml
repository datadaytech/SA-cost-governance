<form version="1.1" theme="dark" script="settings.js" stylesheet="settings.css">
  <label>Settings</label>
  <description>Configure SA Topology Analyzer</description>

  <fieldset submitButton="false" autoRun="true">
  </fieldset>

  <!-- Hero Header & Status Dashboard -->
  <row>
    <panel>
      <html>
        <div class="settings-page">
          <!-- Hero Section -->
          <div class="settings-hero">
            <div class="hero-icon">&#9881;</div>
            <h1 class="hero-title">Settings</h1>
            <p class="hero-subtitle">Configure topology discovery, caching, and visualization preferences</p>
          </div>

          <!-- Status Dashboard -->
          <div class="status-dashboard">
            <div class="metric-card highlight">
              <div class="metric-icon success" id="status-icon">&#10003;</div>
              <div class="metric-value" id="node-count">-</div>
              <div class="metric-label">Nodes Discovered</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon" style="background: var(--status-info-bg); border-color: rgba(59, 130, 246, 0.2); color: var(--status-info);">&#8644;</div>
              <div class="metric-value" id="connection-count">-</div>
              <div class="metric-label">Connections</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon" style="background: var(--bg-interactive);">&#128337;</div>
              <div class="metric-value" id="last-discovery-time" style="font-size: 16px;">Loading...</div>
              <div class="metric-label">Last Discovery</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon" style="background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.2); color: #8b5cf6;">&#9201;</div>
              <div class="metric-value" id="next-run" style="font-size: 20px;">-</div>
              <div class="metric-label">Next Run</div>
            </div>
          </div>

          <!-- Quick Actions Bar -->
          <div class="quick-actions">
            <div class="quick-actions-label">
              <span class="icon">&#9889;</span>
              <span>Quick Actions</span>
            </div>
            <div class="quick-actions-buttons">
              <button class="btn btn-primary" id="run-now-btn">
                <span class="btn-icon">&#9654;</span>
                Run Discovery Now
              </button>
              <button class="btn btn-secondary" id="clear-cache-btn">
                <span class="btn-icon">&#128465;</span>
                Clear Cache
              </button>
            </div>
          </div>

          <!-- Scheduled Discovery Section -->
          <div class="settings-section">
            <div class="section-header">
              <div class="section-title-group">
                <div class="section-icon">&#128197;</div>
                <h2 class="section-title">Scheduled Discovery</h2>
              </div>
              <span class="section-badge" id="schedule-badge">Active</span>
            </div>
            <div class="section-content">
              <div class="info-callout">
                <div class="icon">i</div>
                <div class="content">
                  <div class="title">Automatic Topology Refresh</div>
                  <div class="description">Discovery searches run on schedule to analyze <code>_internal</code> logs and map all Splunk components. Results are cached in KV Store for instant visualization loading.</div>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <div class="setting-label">
                    Enable Scheduled Discovery
                    <span class="tooltip-trigger" title="When enabled, topology is automatically refreshed daily">?</span>
                  </div>
                  <div class="setting-description">Automatically discover and cache topology data on a schedule</div>
                </div>
                <div class="setting-control">
                  <label class="toggle">
                    <input type="checkbox" id="enable-scheduled" checked="checked" />
                    <span class="toggle-track"></span>
                  </label>
                  <span class="toggle-status active" id="schedule-status">Enabled</span>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <div class="setting-label">
                    Discovery Time
                    <span class="tooltip-trigger" title="Best to schedule during off-peak hours (2-4 AM)">?</span>
                  </div>
                  <div class="setting-description">Time when the discovery search runs (24-hour format)</div>
                </div>
                <div class="setting-control">
                  <div class="time-picker">
                    <select id="schedule-hour" class="time-select">
                      <option value="0">00</option>
                      <option value="1">01</option>
                      <option value="2" selected="selected">02</option>
                      <option value="3">03</option>
                      <option value="4">04</option>
                      <option value="5">05</option>
                      <option value="6">06</option>
                      <option value="7">07</option>
                      <option value="8">08</option>
                      <option value="9">09</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                      <option value="17">17</option>
                      <option value="18">18</option>
                      <option value="19">19</option>
                      <option value="20">20</option>
                      <option value="21">21</option>
                      <option value="22">22</option>
                      <option value="23">23</option>
                    </select>
                    <span class="time-separator">:</span>
                    <select id="schedule-minute" class="time-select">
                      <option value="0">00</option>
                      <option value="3" selected="selected">03</option>
                      <option value="15">15</option>
                      <option value="30">30</option>
                      <option value="45">45</option>
                    </select>
                    <span class="time-badge">Daily</span>
                  </div>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <div class="setting-label">
                    Discovery Time Range
                    <span class="tooltip-trigger" title="Longer ranges find more forwarders but take longer">?</span>
                  </div>
                  <div class="setting-description">How far back to search for topology data</div>
                </div>
                <div class="setting-control">
                  <div class="select-wrapper">
                    <select id="discovery-range" class="premium-select">
                      <option value="-1h">Last 1 hour (fastest)</option>
                      <option value="-4h">Last 4 hours</option>
                      <option value="-12h">Last 12 hours</option>
                      <option value="-24h" selected="selected">Last 24 hours (recommended)</option>
                      <option value="-7d">Last 7 days (most complete)</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="btn-group">
                <button class="btn btn-primary" id="save-schedule-btn">
                  <span class="btn-icon">&#10003;</span>
                  Save Schedule
                </button>
              </div>
            </div>
          </div>

          <!-- Visualization Settings Section -->
          <div class="settings-section">
            <div class="section-header">
              <div class="section-title-group">
                <div class="section-icon blue">&#128065;</div>
                <h2 class="section-title">Visualization</h2>
              </div>
            </div>
            <div class="section-content">
              <div class="setting-item">
                <div class="setting-info">
                  <div class="setting-label">Default View Mode</div>
                  <div class="setting-description">Choose data source when opening topology view</div>
                </div>
                <div class="setting-control">
                  <div class="segmented-control" id="view-mode-control">
                    <button class="segment active" data-value="cached">Cached</button>
                    <button class="segment" data-value="live">Live</button>
                    <button class="segment" data-value="mock">Demo</button>
                  </div>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <div class="setting-label">Health Thresholds</div>
                  <div class="setting-description">Define when nodes show warning or critical status</div>
                </div>
                <div class="setting-control" style="gap: 16px;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 13px; color: var(--status-warning);">&#9888;</span>
                    <div class="select-wrapper">
                      <select id="warning-threshold" class="premium-select" style="min-width: 160px;">
                        <option value="15">15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60" selected="selected">1 hour</option>
                        <option value="120">2 hours</option>
                      </select>
                    </div>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 13px; color: var(--status-error);">&#9888;</span>
                    <div class="select-wrapper">
                      <select id="critical-threshold" class="premium-select" style="min-width: 160px;">
                        <option value="60">1 hour</option>
                        <option value="120">2 hours</option>
                        <option value="240" selected="selected">4 hours</option>
                        <option value="480">8 hours</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="btn-group">
                <button class="btn btn-primary" id="save-advanced-btn">
                  <span class="btn-icon">&#10003;</span>
                  Save Preferences
                </button>
              </div>
            </div>
          </div>

          <!-- How It Works Section -->
          <div class="settings-section">
            <div class="section-header">
              <div class="section-title-group">
                <div class="section-icon purple">&#128218;</div>
                <h2 class="section-title">How It Works</h2>
              </div>
            </div>
            <div class="section-content">
              <div class="workflow-grid">
                <div class="workflow-step">
                  <div class="step-number">1</div>
                  <div class="step-title">Scheduled Discovery</div>
                  <div class="step-description">At the configured time, searches run against _internal logs to discover all Splunk components.</div>
                </div>
                <div class="workflow-step">
                  <div class="step-number">2</div>
                  <div class="step-title">KV Store Cache</div>
                  <div class="step-description">Discovered nodes and connections are stored in the KV Store for instant access.</div>
                </div>
                <div class="workflow-step">
                  <div class="step-number">3</div>
                  <div class="step-title">Fast Loading</div>
                  <div class="step-description">Open the topology view and see your infrastructure map load in under a second.</div>
                </div>
                <div class="workflow-step">
                  <div class="step-number">4</div>
                  <div class="step-title">Live Option</div>
                  <div class="step-description">Switch to Live mode anytime for real-time discovery when needed.</div>
                </div>
              </div>

              <div class="runtime-card">
                <div class="runtime-header">
                  <span class="icon">&#9201;</span>
                  <span class="title">Estimated Discovery Runtime</span>
                </div>
                <table class="runtime-table">
                  <thead>
                    <tr>
                      <th>Environment</th>
                      <th>Forwarders</th>
                      <th>Runtime</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Small</td>
                      <td>&lt; 100</td>
                      <td class="highlight">1-3 min</td>
                    </tr>
                    <tr>
                      <td>Medium</td>
                      <td>100 - 500</td>
                      <td class="highlight">3-5 min</td>
                    </tr>
                    <tr>
                      <td>Large</td>
                      <td>500 - 2,000</td>
                      <td class="highlight">5-10 min</td>
                    </tr>
                    <tr>
                      <td>Enterprise</td>
                      <td>2,000+</td>
                      <td class="highlight">10-20 min</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

        </div>
      </html>
    </panel>
  </row>

</form>
