# Cost Governance Saved Searches
# Scheduled reports for cost monitoring and alerting

# Daily License Usage Summary
[Cost Governance - Daily License Usage]
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 6 * * *
description = Daily summary of license usage across the environment
dispatch.earliest_time = -1d@d
dispatch.latest_time = @d
display.general.type = statistics
display.page.search.tab = statistics
enableSched = 1
request.ui_dispatch_app = SA-cost-governance
request.ui_dispatch_view = search
search = `daily_license_usage(1)` | eval status=case(GB_used > (license_quota * 0.95), "critical", GB_used > (license_quota * 0.80), "warning", 1=1, "ok")

# Heavy Search Detection
[Cost Governance - Heavy Search Alert]
action.email.useNSSubject = 1
alert.severity = 4
alert.suppress = 1
alert.suppress.period = 1h
alert.track = 1
counttype = number of events
cron_schedule = */15 * * * *
description = Detects searches with high scan counts that may impact cluster performance
dispatch.earliest_time = -15m
dispatch.latest_time = now
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = SA-cost-governance
request.ui_dispatch_view = search
search = | rest /services/search/jobs splunk_server=local | where scanCount > 10000000 | table sid, label, user, runDuration, scanCount

# Weekly Cost Report
[Cost Governance - Weekly Cost Report]
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 8 * * 1
description = Weekly summary of estimated costs by index and user
dispatch.earliest_time = -7d@d
dispatch.latest_time = @d
display.general.type = statistics
enableSched = 1
request.ui_dispatch_app = SA-cost-governance
request.ui_dispatch_view = search
search = index=_internal sourcetype=splunkd component=LicenseUsage type=Usage | stats sum(b) as bytes by idx | eval GB=round(bytes/1024/1024/1024, 2) | lookup cost_governance_settings cost_per_gb OUTPUT cost_per_gb | eval estimated_cost=GB*cost_per_gb | sort -estimated_cost

# Index Growth Trend
[Cost Governance - Index Growth Trend]
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 7 * * *
description = Daily tracking of index growth trends
dispatch.earliest_time = -30d@d
dispatch.latest_time = @d
display.general.type = visualizations
display.visualizations.type = charting
enableSched = 1
request.ui_dispatch_app = SA-cost-governance
search = index=_internal sourcetype=splunkd component=LicenseUsage type=Usage | timechart span=1d sum(b) as bytes by idx | untable _time idx bytes | eval GB=round(bytes/1024/1024/1024, 2)

# User Search Activity Summary
[Cost Governance - User Search Activity]
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 6 * * *
description = Daily summary of search activity by user
dispatch.earliest_time = -1d@d
dispatch.latest_time = @d
display.general.type = statistics
enableSched = 1
request.ui_dispatch_app = SA-cost-governance
search = `user_search_activity(-1d@d)`
