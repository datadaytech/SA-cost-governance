<dashboard version="1.1" theme="dark">
  <label>Index Allocation</label>
  <description>Cost allocation and budget tracking by index</description>

  <row>
    <panel>
      <title>Index Cost Allocation</title>
      <table>
        <search>
          <query>| rest /services/data/indexes splunk_server=local
| join type=left title [| inputlookup index_cost_allocation.csv | rename index_name as title]
| eval currentDBSizeMB_GB=round(currentDBSizeMB/1024, 2)
| table title, cost_center, owner, currentDBSizeMB_GB, budget_allocation, notes
| rename title as "Index", cost_center as "Cost Center", owner as "Owner", currentDBSizeMB_GB as "Current Size (GB)", budget_allocation as "Budget", notes as "Notes"
| fillnull value="-"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">50</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Index Size Distribution</title>
      <chart>
        <search>
          <query>| rest /services/data/indexes splunk_server=local
| eval size_GB=round(currentDBSizeMB/1024, 2)
| where size_GB > 0
| sort -size_GB
| head 15
| table title, size_GB</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">true</option>
      </chart>
    </panel>
    <panel>
      <title>Index Growth (Last 30 Days)</title>
      <chart>
        <search>
          <query>index=_internal sourcetype=splunkd component=LicenseUsage type=Usage
| timechart span=1d sum(b) as bytes by idx
| untable _time idx bytes
| eval GB=round(bytes/1024/1024/1024, 2)
| where GB > 0.1
| xyseries _time idx GB</query>
          <earliest>-30d@d</earliest>
          <latest>@d</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleY.text">GB Ingested</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Index Properties</title>
      <table>
        <search>
          <query>| rest /services/data/indexes splunk_server=local
| table title, homePath, maxTotalDataSizeMB, frozenTimePeriodInSecs, maxDataSize, maxHotBuckets, disabled
| eval retention_days=round(frozenTimePeriodInSecs/86400, 0)
| eval max_size_GB=round(maxTotalDataSizeMB/1024, 0)
| table title, max_size_GB, retention_days, maxHotBuckets, disabled
| rename title as "Index", max_size_GB as "Max Size (GB)", retention_days as "Retention (days)", maxHotBuckets as "Hot Buckets", disabled as "Disabled"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">50</option>
      </table>
    </panel>
  </row>
</dashboard>
